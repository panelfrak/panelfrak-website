<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} | {{ .Site.Title }}</title>
        <script>
            (function() {
                var storageKey = 'theme';
                var mql = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
                var defaultPref = {{ default "system" .Site.Params.themeDefault | jsonify }};
                function normalize(v){ v = (v||'').toLowerCase(); return (v==='light'||v==='dark'||v==='system') ? v : 'system'; }
                function setClass(mode){ document.documentElement.classList.toggle('dark', mode === 'dark'); }
                function updateLabel(mode){ var el = document.getElementById('theme-mode'); if (el) { el.textContent = mode.charAt(0).toUpperCase() + mode.slice(1); } }
                var stored = null; try { stored = localStorage.getItem(storageKey); } catch (e) {}
                var current = normalize(stored || defaultPref);
                var mqlListener = null;
                function applyFromSystem(){ setClass(mql && mql.matches ? 'dark' : 'light'); }
                function setTheme(mode, persist){
                    mode = normalize(mode);
                    if (mql && mqlListener) { mql.removeEventListener('change', mqlListener); mqlListener = null; }
                    if (mode === 'system') {
                        applyFromSystem();
                        if (mql && mql.addEventListener) {
                            mqlListener = function(){ applyFromSystem(); updateLabel('system'); };
                            mql.addEventListener('change', mqlListener);
                        }
                    } else {
                        setClass(mode);
                    }
                    document.documentElement.dataset.theme = mode;
                    if (persist !== false) { try { localStorage.setItem(storageKey, mode); } catch(e) {} }
                    updateLabel(mode);
                }
                // Initialize
                setTheme(current, false);
                // Public API
                window.__setTheme = function(mode){ setTheme(mode, true); };
                window.__cycleTheme = function(){
                    var mode = document.documentElement.dataset.theme || current;
                    var next = mode === 'light' ? 'dark' : mode === 'dark' ? 'system' : 'light';
                    setTheme(next, true);
                };
            })();
        </script>
    {{ with (templates.Defer (dict "key" "global")) }}
      {{ partial "css.html" . }}
    {{ end }}
    {{ partial "js.html" . }}
</head>
<body class="bg-white text-gray-900 dark:bg-gray-950 dark:text-cyan-50">
    {{ partial "header.html" . }}
    
    <main>
        {{ block "main" . }}{{ end }}
    </main>
    
    {{ partial "footer.html" . }}
</body>
</html>
