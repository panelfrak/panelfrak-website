{{ define "main" }}
{{ $heroes := site.Data.hero }}
{{ $works := first 3 (sort (where site.RegularPages "Section" "works") "Date" "desc") }}
{{ $posts := first 3 (sort (where site.RegularPages "Section" "posts") "Date" "desc") }}

<section class="container mx-auto px-4 py-12 md:py-16">
    <div class="flex flex-wrap items-start justify-between gap-4 mb-6">
        <div class="space-y-1">
            <p class="text-sm uppercase tracking-wide text-cyan-500 dark:text-cyan-300">Featured worlds</p>
            <h1 class="text-4xl md:text-6xl font-bold leading-tight text-gray-900 dark:text-cyan-200">{{ .Title }}</h1>
            <p class="text-base text-gray-600 dark:text-cyan-100/80 max-w-2xl">New slices of the PanelFRAK universeâ€”grab a panel, follow the chase, then dive into the archive.</p>
        </div>
        <div class="flex items-center gap-3 flex-wrap">
            <button type="button" class="inline-flex items-center gap-2 px-3 py-2 rounded-md border border-gray-200 text-gray-700 hover:bg-gray-100 dark:border-cyan-400/30 dark:text-cyan-100 dark:hover:bg-gray-800 transition" data-hero-toggle>
                <span aria-live="polite" data-hero-toggle-label>Pause autoplay</span>
            </button>
            <div class="inline-flex shadow-sm rounded-md overflow-hidden border border-gray-200 dark:border-cyan-400/30">
                <button type="button" class="px-3 py-2 bg-white hover:bg-gray-100 dark:bg-gray-900 dark:hover:bg-gray-800 text-gray-700 dark:text-cyan-100" aria-label="Previous hero" data-hero-prev>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M15.75 19.5 8.25 12l7.5-7.5"/></svg>
                </button>
                <button type="button" class="px-3 py-2 bg-white hover:bg-gray-100 dark:bg-gray-900 dark:hover:bg-gray-800 text-gray-700 dark:text-cyan-100 border-l border-gray-200 dark:border-cyan-400/30" aria-label="Next hero" data-hero-next>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="m8.25 4.5 7.5 7.5-7.5 7.5"/></svg>
                </button>
            </div>
        </div>
    </div>

    {{ with $heroes }}
    <div id="hero-slider" class="relative overflow-hidden rounded-2xl border border-gray-200 dark:border-cyan-400/30 shadow-lg h-[320px] md:h-[480px] bg-gray-50 dark:bg-gray-900">
        {{ range $index, $hero := . }}
            <a href="{{ $hero.link | relURL }}" class="absolute inset-0 transition-opacity duration-700 ease-in-out {{ if eq $index 0 }}opacity-100{{ else }}opacity-0 pointer-events-none{{ end }}" data-hero-index="{{ $index }}">
                <img src="{{ $hero.image }}" alt="{{ $hero.title }}" class="w-full h-full object-cover" loading="lazy">
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/25 to-transparent"></div>
                <div class="absolute bottom-0 left-0 right-0 p-6 md:p-8 flex flex-col gap-2 text-white">
                    <span class="text-xs uppercase tracking-wide text-cyan-200">Linked feature</span>
                    <div class="flex flex-wrap items-center gap-3">
                        <h2 class="text-2xl md:text-3xl font-semibold">{{ $hero.title }}</h2>
                        {{ with $hero.subtitle }}<span class="text-sm px-3 py-1 rounded-full bg-white/15 backdrop-blur">{{ . }}</span>{{ end }}
                    </div>
                </div>
            </a>
        {{ end }}
    </div>
    {{ end }}
</section>

<section class="container mx-auto px-4 py-12 md:py-16">
    <div class="flex items-center justify-between gap-4 mb-6">
        <div>
            <p class="text-sm uppercase tracking-wide text-cyan-500 dark:text-cyan-300">Latest works</p>
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-cyan-200">Fresh off the drawing board</h2>
        </div>
    </div>
    {{ if $works }}
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {{ range $works }}
            {{ $desc := (default "" .Params.description | plainify | truncate 150) }}
            <article class="group bg-white dark:bg-gray-900 border border-gray-200 dark:border-cyan-400/30 rounded-2xl shadow-sm overflow-hidden flex flex-col">
                <div class="relative aspect-[4/3] overflow-hidden">
                    {{ with .Params.image }}
                        <img src="{{ . }}" alt="{{ $.Title }} cover" class="w-full h-full object-cover transition duration-500 group-hover:scale-105" loading="lazy">
                    {{ else }}
                        <div class="w-full h-full bg-gradient-to-br from-cyan-100 to-blue-100 dark:from-cyan-900/40 dark:to-blue-900/30"></div>
                    {{ end }}
                </div>
                <div class="p-5 flex flex-col gap-3 flex-1">
                    <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-cyan-600 dark:text-cyan-300">
                        {{ with .Params.series }}<span>{{ . }}</span>{{ end }}
                        {{ with .Params.genre }}<span class="px-2 py-1 rounded-full bg-cyan-100 text-cyan-800 dark:bg-cyan-900/50 dark:text-cyan-100">{{ delimit . ", " }}</span>{{ end }}
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 dark:text-cyan-100">
                        <a href="{{ .RelPermalink }}" class="hover:text-cyan-600 dark:hover:text-cyan-200 transition">{{ .Title }}</a>
                    </h3>
                    <p class="text-sm text-gray-700 dark:text-gray-200/90 leading-relaxed">{{ $desc }}</p>
                    <div class="mt-auto flex items-center justify-between text-sm text-gray-500 dark:text-gray-300">
                        <span>{{ .Date.Format "Jan 2, 2006" }}</span>
                        <a href="{{ .RelPermalink }}" class="inline-flex items-center gap-1 text-cyan-700 dark:text-cyan-200 hover:underline">Read work
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="m9 5 7 7-7 7"/></svg>
                        </a>
                    </div>
                </div>
            </article>
            {{ end }}
        </div>
    {{ else }}
        <p class="text-gray-600 dark:text-gray-200">No works published yet. Add entries under <code>content/works</code> to see them here.</p>
    {{ end }}
</section>

<section class="container mx-auto px-4 py-12 md:py-16">
    <div class="flex items-center justify-between gap-4 mb-6">
        <div>
            <p class="text-sm uppercase tracking-wide text-cyan-500 dark:text-cyan-300">Latest articles</p>
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-cyan-200">From the blog</h2>
        </div>
        <a href="{{ relURL "/posts" }}" class="inline-flex items-center gap-2 text-cyan-700 dark:text-cyan-100 hover:underline">View archive
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="m9 5 7 7-7 7"/></svg>
        </a>
    </div>
    {{ if $posts }}
        <div class="grid gap-6 md:grid-cols-3">
            {{ range $posts }}
            <article class="h-full flex flex-col gap-3 p-5 rounded-2xl bg-white dark:bg-gray-900 border border-gray-200 dark:border-cyan-400/30 shadow-sm">
                <div class="text-sm text-gray-500 dark:text-gray-300 flex items-center justify-between">
                    <span>{{ .Date.Format "Jan 2, 2006" }}</span>
                    {{ with .Params.categories }}<span class="px-2 py-1 rounded-full bg-cyan-100 text-cyan-800 dark:bg-cyan-900/50 dark:text-cyan-100 text-xs">{{ delimit . ", " }}</span>{{ end }}
                </div>
                <h3 class="text-xl font-semibold text-gray-900 dark:text-cyan-100">
                    <a href="{{ .RelPermalink }}" class="hover:text-cyan-600 dark:hover:text-cyan-200 transition">{{ .Title }}</a>
                </h3>
                <p class="text-sm text-gray-700 dark:text-gray-200/90 leading-relaxed">{{ .Summary | plainify | truncate 140 }}</p>
                <a href="{{ .RelPermalink }}" class="inline-flex items-center gap-2 text-cyan-700 dark:text-cyan-100 hover:underline">Read article
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="m9 5 7 7-7 7"/></svg>
                </a>
            </article>
            {{ end }}
        </div>
    {{ else }}
        <p class="text-gray-600 dark:text-gray-200">No blog posts yet. Add entries under <code>content/posts</code> to see them here.</p>
    {{ end }}
</section>

{{ if .Content }}
<section class="container mx-auto px-4 pb-16">
    <div class="prose prose-lg dark:prose-invert max-w-4xl">
        {{ .Content }}
    </div>
</section>
{{ end }}

<script>
(function(){
    const slider = document.getElementById('hero-slider');
    if (!slider) return;
    const slides = Array.from(slider.querySelectorAll('[data-hero-index]'));
    if (slides.length === 0) return;
    let index = 0;
    let paused = false;
    let timer = null;

    const show = (i) => {
        index = (i + slides.length) % slides.length;
        slides.forEach((el, idx) => {
            const active = idx === index;
            el.classList.toggle('opacity-100', active);
            el.classList.toggle('opacity-0', !active);
            el.classList.toggle('pointer-events-none', !active);
        });
    };

    const next = () => show(index + 1);
    const prev = () => show(index - 1);

    const toggleBtn = document.querySelector('[data-hero-toggle]');
    const label = document.querySelector('[data-hero-toggle-label]');
    const updateLabel = () => { if (label) { label.textContent = paused ? 'Resume autoplay' : 'Pause autoplay'; } };

    const start = () => {
        if (timer) clearInterval(timer);
        timer = setInterval(() => { if (!paused && slides.length > 1) { next(); } }, 5000);
    };

    document.querySelector('[data-hero-next]')?.addEventListener('click', () => { paused = true; updateLabel(); next(); });
    document.querySelector('[data-hero-prev]')?.addEventListener('click', () => { paused = true; updateLabel(); prev(); });
    toggleBtn?.addEventListener('click', () => { paused = !paused; updateLabel(); });

    slider.addEventListener('mouseenter', () => { paused = true; updateLabel(); });
    slider.addEventListener('mouseleave', () => { paused = false; updateLabel(); });

    updateLabel();
    start();
})();
</script>
{{ end }}
